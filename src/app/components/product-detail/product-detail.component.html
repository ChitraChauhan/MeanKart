<div class="product-detail-container">

  <button
    (click)="router.navigate(['/products'])"
    class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
  >
    <i class="fas fa-arrow-left mr-2"></i>
    Back to Products
  </button>

  @if (loading) {
    <div class="loading">Loading product details...</div>
  } @else if (error) {
    <div class="error">{{ error }}</div>
  } @else if (product) {
    <div class="product-detail">
      <div class="product-image-carousel">
        <div class="main-image-container">
          <img
            [src]="imageService.getImagePreview(product.imageUrl[currentImageIndex])"
            [alt]="product.name + ' - Image ' + (currentImageIndex + 1)"
            class="main-image scale-90 hover:scale-105 transition-transform duration-300 cursor-pointer"
          >

          @if (product.imageUrl.length > 1) {
            <div class="carousel-controls">
              <button class="carousel-nav prev" (click)="prevImage()" aria-label="Previous image">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button class="carousel-nav next" (click)="nextImage()" aria-label="Next image">
                <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          }
        </div>
      </div>

      <div class="product-info">
        <h1>{{ product.name }}</h1>
        <div class="price">â‚¹{{ product.price | number:'1.2-2' }}</div>

        <div class="stock-status" [class.in-stock]="isInStock()" [class.out-of-stock]="!isInStock()">
          <i class="fas {{ isInStock() ? 'fa-check-circle' : 'fa-times-circle' }}"></i>
          {{ isInStock() ? 'In Stock' : 'Out of Stock' }}
          @if (product.stock > 0) {
            <span class="stock-count">({{ product.stock }} available)</span>
          }
        </div>

        <div class="description mb-6">
          <h3 class="text-lg font-semibold mb-2">Description</h3>
          <p class="text-gray-700">{{ product.description || 'No description available.' }}</p>
        </div>

        <!-- Specifications Section -->
        <div class="specifications mb-6">
          <h3 class="text-lg font-semibold mb-3">Specifications</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            @if (product.specifications.brand) {
              <div class="spec-item">
                <span class="font-medium text-gray-600">Brand: </span>
                <span>{{ product.specifications.brand }}</span>
              </div>
            }
            @if (product.specifications.model) {
              <div class="spec-item">
                <span class="font-medium text-gray-600">Model: </span>
                <span>{{ product.specifications.model }}</span>
              </div>
            }
            @if (product.specifications.color) {
              <div class="spec-item">
                <span class="font-medium text-gray-600">Color: </span>
                <span>{{ product.specifications.color }}</span>
              </div>
            }
            @if (product.specifications.size) {
              <div class="spec-item">
                <span class="font-medium text-gray-600">Size: </span>
                <span>{{ product.specifications.size }}</span>
              </div>
            }
            @if (product.specifications.weight) {
              <div class="spec-item">
                <span class="font-medium text-gray-600">Weight: </span>
                <span>{{ product.specifications.weight }} KG</span>
              </div>
            }
          </div>
        </div>

        <div class="quantity-selector mb-6">
          <button (click)="updateQuantity(-1)">-</button>
          <span>{{ product?.items?.length || quantity }}</span>
          <button (click)="updateQuantity(1)">+</button>
        </div>

        <button
          (click)="addToCart()"
          class="add-to-cart bg-yellow-500 hover:bg-yellow-600  mb-2"
          [class.disabled]="!isInStock()"
          [disabled]="!isInStock()"
        >
          <i class="fas fa-shopping-cart"></i> {{ isInStock() ? 'Add to Cart' : 'Out of Stock' }}
        </button>
        @if (isInStock()) {
          <button
            (click)="payNow()"
            [disabled]="quantity <= 0"
            class="pay-now-btn"
          >
            <i class="fas fa-bolt"></i> Buy Now
          </button>
        }
      </div>
    </div>
  }
</div>
